# Token Counter Statusline

[![en](https://img.shields.io/badge/lang-en-blue.svg)](README.md)
[![ru](https://img.shields.io/badge/lang-ru-green.svg)](README.ru.md)

Кастомный статусбар для Claude Code с отображением стоимости сессии, использования контекста и git-ветки.

## Превью

```
project (main) • Opus 4.5 • $0.42 • $3.15 / $127.50 • 23%
```

- **project** — Имя текущей директории
- **(main)** — Git-ветка (если в репозитории)
- **Opus 4.5** — Текущая модель
- **$0.42** — Стоимость сессии (зелёный)
- **$3.15** — Стоимость за сегодня
- **$127.50** — Общая стоимость (приглушённый)
- **23%** — Использование контекстного окна (зелёный/жёлтый/красный)

## Требования

- `jq` — обработка JSON
- `bc` — вычисления
- `bun` — для запуска ccusage
- [`ccusage`](https://github.com/ryoppippi/ccusage) — трекер использования Claude Code

### Установка зависимостей

```bash
# macOS
brew install jq bc

# bun (если не установлен)
curl -fsSL https://bun.sh/install | bash

# ccusage запускается через bunx, установка не нужна
```

## Установка

1. Скопируй скрипт в конфиг Claude:

```bash
cp token-counter.sh ~/.claude/
chmod +x ~/.claude/token-counter.sh
```

2. Добавь в `~/.claude/settings.json`:

```json
{
  "statusLine": {
    "type": "command",
    "command": "bash ~/.claude/token-counter.sh"
  }
}
```

3. Перезапусти Claude Code.

## Цветовая кодировка

**Использование контекста:**
- Зелёный: < 30%
- Жёлтый: 30-60%
- Красный: > 60%

**Стоимость:**
- Стоимость сессии — зелёная
- Общая стоимость — приглушённая для меньшего визуального шума

## Как это работает

Скрипт получает JSON от Claude Code через stdin, содержащий:
- Информацию о воркспейсе (текущая директория)
- Название модели
- Статистику контекстного окна (входящие/исходящие токены, размер окна)
- Стоимость и длительность сессии

Он комбинирует это с данными `ccusage` о затратах за сегодня/всего и форматирует всё с ANSI-цветами.
