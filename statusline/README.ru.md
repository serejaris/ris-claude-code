# Statusline

[![en](https://img.shields.io/badge/lang-en-blue.svg)](README.md)
[![ru](https://img.shields.io/badge/lang-ru-green.svg)](README.ru.md)

Кастомный статусбар для Claude Code с отображением OAuth лимитов, стоимости сессии и использования контекста.

## Превью

```
project (main) • Opus 4.5 • 2h15m 67% W85% • $0.42 • 23%
```

- **project** — Имя текущей директории
- **(main)** — Git-ветка (если в репозитории)
- **Opus 4.5** — Текущая модель
- **2h15m 67%** — Время до сброса 5-часового лимита + остаток % (с цветом)
- **W85%** — Остаток недельного лимита %
- **$0.42** — Стоимость сессии (зелёный)
- **23%** — Использование контекстного окна (зелёный/жёлтый/красный)

## Требования

- `jq` — обработка JSON
- `curl` — API запросы
- `python3` — расчёт времени
- macOS Keychain — для доступа к OAuth токену

### Установка зависимостей

```bash
# macOS
brew install jq
# python3 и curl предустановлены на macOS
```

## Установка

1. Скопируй скрипт в конфиг Claude:

```bash
cp statusline.sh ~/.claude/
chmod +x ~/.claude/statusline.sh
```

2. Добавь в `~/.claude/settings.json`:

```json
{
  "statusLine": {
    "type": "command",
    "command": "bash ~/.claude/statusline.sh"
  }
}
```

3. Перезапусти Claude Code.

## Цветовая кодировка

**Лимиты использования (остаток %):**
- Белый: > 50%
- Жёлтый: 20-50%
- Красный: < 20%

**Использование контекста:**
- Зелёный: < 50%
- Жёлтый: 50-80%
- Красный: > 80%

## Как это работает

Скрипт:
1. Получает JSON от Claude Code через stdin (воркспейс, модель, контекст, стоимость)
2. Запрашивает OAuth лимиты из Anthropic API (кэш на 2 минуты)
3. Вычисляет оставшийся % для 5-часового и недельного лимитов
4. Показывает таймер обратного отсчёта до сброса 5-часового лимита
5. Форматирует всё с ANSI-цветами

OAuth токен извлекается из macOS Keychain (`Claude Code-credentials`).
